import React, { useState, useEffect } from "react";
import axios from "axios";
import { useParams } from "react-router-dom";
import Header from "../Admin/Header";
import AdminSideBar from "../Admin/AdminSidebar";
import Footer from "../Common/Footer";

export default function UpdateBills() {
  const [newName, setnewName] = useState("");
  const [newAmount, setnewAmount] = useState("");
  const [newStatus, setnewStatus] = useState(0);
  const [newDate, setnewDate] = useState("");

  const { id } = useParams();

  useEffect(() => {
    axios
      .get(`http://localhost:8070/bills/readBillsByID/${id}`)
      .then((res) => {
        setnewName(res.data[0].name);
        setnewAmount(res.data[0].amount);
        setnewStatus(res.data[0].status);
        setnewDate(res.data[0].date);
      })
      .catch((err) => {
        console.log(err);
      });
  }, [id]);

  // Validation function
  function validateInputs() {
    if (!newName.trim()) {
      alert("Name is required.");
      return false;
    }
    if (!newAmount || isNaN(newAmount) || Number(newAmount) <= 0) {
      alert("Please enter a valid amount greater than 0.");
      return false;
    }
    if (newStatus !== 0 && newStatus !== 1) {
      alert("Status must be 0 (Pending) or 1 (Completed).");
      return false;
    }
    if (!newDate) {
      alert("Date is required.");
      return false;
    }
    return true;
  }

  function updateData(e) {
    e.preventDefault();

    // Check if inputs are valid
    if (!validateInputs()) {
      return;
    }

    const newSupp = {
      name: newName,
      amount: newAmount,
      status: newStatus,
      date: newDate,
    };

    axios
      .put(`http://localhost:8070/bills/updateBills/${id}`, newSupp)
      .then(() => {
        alert("Bill details updated successfully.");
        window.location.replace("http://localhost:3000/bills");
      })
      .catch((err) => {
        alert("Error updating bill: " + err);
      });
  }

  return (
    <div>
      <Header></Header>

      <div className="container">
        <AdminSideBar></AdminSideBar>
        <div className="container" style={{ marginTop: "100px" }}>
          <form onSubmit={updateData}>
            <h3>Update Bill Details</h3>

            <div className="form-group">
              <label htmlFor="Name">Name</label>
              <input
                type="text"
                className="form-control"
                id="name"
                value={newName}
                onChange={(e) => setnewName(e.target.value)}
              />
            </div>

            <div className="form-group">
              <label htmlFor="amount">Amount</label>
              <input
                type="text"
                className="form-control"
                id="amount"
                value={newAmount}
                onChange={(e) => setnewAmount(e.target.value)}
              />
            </div>

            <div className="form-group">
              <label htmlFor="status">Status (0: Pending, 1: Completed)</label>
              <input
                type="number"
                className="form-control"
                id="status"
                value={newStatus}
                onChange={(e) => setnewStatus(Number(e.target.value))}
              />
            </div>

            <div className="form-group">
              <label htmlFor="date">Date</label>
              <input
                type="date"
                className="form-control"
                id="date"
                value={newDate}
                onChange={(e) => setnewDate(e.target.value)}
              />
            </div>

            <button
              type="submit"
              className="btn btn-primary"
              style={{ marginTop: "10px" }}
            >
              Update <i className="fa fa-check"></i>
            </button>

            <a
              href="/bills"
              type="button"
              className="btn btn-secondary"
              style={{ marginTop: "20px", marginLeft: "20px" }}
            >
              Back <i className="fa fa-reply"></i>
            </a>
          </form>
        </div>
      </div>
      <Footer></Footer>
    </div>
  );
}
