import React, { useState } from "react";
import Header from "../Admin/Header";
import AdminSideBar from "../Admin/AdminSidebar";
import Footer from "../Common/Footer";
import axios from "axios";

export default function AddSupplier() {
  const [type, setType] = useState("");
  const [category, setCategory] = useState("");
  const [amount, setAmount] = useState("");
  const [remark, setRemark] = useState("");
  const [date, setDate] = useState("");
  const [name, setName] = useState("");

  function validateForm() {
    if (!name.trim()) {
      alert("Name field is required!");
      return false;
    }
    if (!type) {
      alert("Please select a transaction type (Income or Expense)!");
      return false;
    }
    if (!category.trim()) {
      alert("Category field is required!");
      return false;
    }
    if (!amount) {
      alert("Amount field is required!");
      return false;
    }
    if (isNaN(amount) || amount <= 0) {
      alert("Amount must be a positive number!");
      return false;
    }
    if (!remark.trim()) {
      alert("Remark field is required!");
      return false;
    }
    if (!date) {
      alert("Date field is required!");
      return false;
    }
    const today = new Date().toISOString().split("T")[0]; // get current date in YYYY-MM-DD format
    if (date > today) {
      alert("Date cannot be in the future!");
      return false;
    }
    return true;
  }

  function sendData(e) {
    e.preventDefault();

    if (!validateForm()) {
      return;
    }

    const newSupplier = {
      name,
      type,
      category,
      amount,
      remark,
      date,
      did: "",
    };

    axios
      .post("http://localhost:8070/financeTransaction/insertT", newSupplier)
      .then(() => {
        alert("Transaction details added successfully!");
        window.location.replace("http://localhost:3000/financeTrans");
      })
      .catch((err) => {
        alert(`Error: ${err.response ? err.response.data.error : err.message}`);
      });
  }

  return (
    <div>
      <Header />

      <div className="containerf">
        <AdminSideBar />

        <div className="container1">
          <div className="row justify-content-center">
            <div className="col-lg-5">
              <br />
              <br />
              <br />
              <div className="card shadow-lg border-0 rounded-lg mt-5">
                <div className="card-header">
                  <h3 className="text-center font-weight-light my-4">
                    Add Transaction
                  </h3>
                </div>
                <div className="card-body">
                  <form onSubmit={sendData}>
                    <div className="form-floating mb-3">
                      <label htmlFor="name">Name</label>
                      <br />
                      <br />
                      <input
                        type="text"
                        className="form-control"
                        id="name"
                        value={name}
                        onChange={(e) => setName(e.target.value)}
                      />
                    </div>

                    <div className="form-floating mb-3">
                      <select
                        name="type"
                        id="select"
                        className="form-control"
                        placeholder="Type"
                        value={type}
                        onChange={(e) => setType(e.target.value)}
                      >
                        <option value="">--Select a type--</option>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                      </select>
                    </div>

                    <div className="form-floating mb-3">
                      <label htmlFor="category">Category</label>
                      <br />
                      <br />
                      <input
                        type="text"
                        className="form-control"
                        id="category"
                        value={category}
                        onChange={(e) => setCategory(e.target.value)}
                      />
                    </div>

                    <div className="form-floating mb-3">
                      <label htmlFor="amount">Amount</label>
                      <br />
                      <br />
                      <input
                        type="number"
                        className="form-control"
                        id="amount"
                        value={amount}
                        onChange={(e) => setAmount(e.target.value)}
                        min="0"
                        step="any"
                      />
                    </div>

                    <div className="form-floating mb-3">
                      <label htmlFor="remark">Remark</label>
                      <br />
                      <br />
                      <input
                        type="text"
                        className="form-control"
                        id="remark"
                        value={remark}
                        onChange={(e) => setRemark(e.target.value)}
                      />
                    </div>

                    <div className="form-floating mb-3">
                      <label htmlFor="date">Date</label>
                      <br />
                      <br />
                      <input
                        type="date"
                        className="form-control"
                        id="date"
                        value={date}
                        onChange={(e) => setDate(e.target.value)}
                      />
                    </div>

                    <div className="d-grid">
                      <button
                        type="submit"
                        className="btn btn-primary btn-block"
                        style={{ marginTop: "10px" }}
                      >
                        Insert
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <Footer />
    </div>
  );
}
